<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NJ Counties by Pop</title>
  <style>
  .county {
    fill: #ece2f0;
    border: 1px solid #eee;
  }
  </style>
</head>
<body>
  <h1>NJ Counties by Relative Population Size</h1>
  <div id="holder"></div>
  <script src="d3.js"></script>
  <script src="topojson.v1.js"></script>
  <script>
  function squareMe(val) {
    return Math.sqrt(val);
  }

  var width = 960,
    height = 1160;

  var svg = d3.select('#holder').append('svg')
      .attr('width', width)
      .attr('height', height);

  var projection = d3.geo.mercator()
        .center([-74.67,40.09])
        .scale(8600)
        .translate([200,250]);

  var path = d3.geo.path().projection(projection);

  d3.json('nj.json', function(err, nj) {
    if (err) {return console.error(err);}

    var counties = topojson.feature(nj, nj.objects.counties),
      geodata = topojson.feature(nj, nj.objects.counties).features,
      popList = geodata.map(function(item) {return item['properties'].population;})
      maxPop = d3.max(popList),
      minPop = d3.min(popList),
      popScale = d3.scale.linear().domain([minPop, maxPop]).range([5,30]);

    svg.append('path')
      .datum(counties)
      .attr('d', path);

    svg.selectAll('.county')
      .data(geodata)
    .enter().append('path')
      .attr('class', function(d) {return 'county ';})
      .attr('data-name', function(d) {return d.properties.NAME;})
      .attr('id', function(d) {return d.properties.COUNTYFP;})
      .attr('d', path);

    svg.selectAll('circle')
      .data(geodata)
    .enter().append('circle')
      .attr('data-population', function(d) { return d.properties.population; })
      .attr('r', function(d) {return popScale(d.properties.population);})
      .attr('cx', function(d) {return projection(d3.geo.centroid(d))[0];})
      .attr('cy', function(d) {return projection(d3.geo.centroid(d))[1];})
      .attr('stroke', '#1c9099')
      .style('fill', '#a6bddb');

    svg.selectAll('text')
      .data(geodata)
    .enter().append('text')
      .attr('text-anchor', 'middle')
      .attr('x', function(d) {return projection(d3.geo.centroid(d))[0];})
      .attr('y', function(d) {return projection(d3.geo.centroid(d))[1];})
      .attr('font-family', 'sans-serif')
      .attr('font-size', '10px')
      .text(function(d) {return d.properties.NAME;});
  });

  </script>
</body>
</html>
